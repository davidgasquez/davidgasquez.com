<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pairwise Comparator</title>
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚖️</text></svg>">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 1rem;
      background: linear-gradient(135deg, #2d3436 0%, #1e3d3a 100%);
      color: #74b9a3;
      line-height: 1.4;
    }

    .hidden {
      display: none;
    }

    .card {
      flex: 1;
      margin: 0.5rem;
      padding: 2rem 1rem;
      background: rgba(116, 185, 163, 0.08);
      border: 2px solid #4a7c59;
      border-radius: 0;
      cursor: pointer;
      text-align: center;
      font-size: 1.1rem;
      font-weight: bold;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 0.5rem;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(116, 185, 163, 0.1), transparent);
      transition: left 0.5s;
    }

    .card:hover {
      border-color: #74b9a3;
      background: rgba(116, 185, 163, 0.15);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(116, 185, 163, 0.2);
    }

    .card:hover::before {
      left: 100%;
    }

    .card-arrow {
      font-size: 1.5rem;
      color: #4a7c59;
      opacity: 0.7;
      font-weight: bold;
    }

    .card:hover .card-arrow {
      color: #74b9a3;
      opacity: 1;
    }

    .split {
      display: flex;
      gap: 1rem;
      width: 100%;
      max-width: 700px;
      margin: 2rem auto;
    }

    button {
      padding: 0.8rem 1.5rem;
      font-family: inherit;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      border: 2px solid #4a7c59;
      border-radius: 0;
      background: rgba(116, 185, 163, 0.08);
      color: #74b9a3;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    button:hover {
      background: rgba(116, 185, 163, 0.2);
      border-color: #74b9a3;
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
    }

    textarea {
      width: 100%;
      height: 8rem;
      font-family: inherit;
      font-size: 0.85rem;
      padding: 1rem;
      border: 2px solid #4a7c59;
      border-radius: 0;
      background: rgba(116, 185, 163, 0.05);
      color: #74b9a3;
      resize: none;
      line-height: 1.3;
    }

    textarea:focus {
      outline: none;
      border-color: #74b9a3;
      background: rgba(116, 185, 163, 0.1);
    }

    .container {
      text-align: center;
      max-width: 800px;
      width: 100%;
    }

    h1 {
      color: #74b9a3;
      margin-bottom: 1rem;
      font-size: 2.2rem;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 3px;
      text-shadow: 0 0 10px rgba(116, 185, 163, 0.3);
    }

    h2 {
      color: #74b9a3;
      margin-bottom: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    #progress-container {
      margin-bottom: 2rem;
      text-align: center;
    }

    #progress-label {
      font-weight: bold;
      color: #95d5b2;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 0.5rem;
    }

    #progress-bar {
      width: 300px;
      height: 20px;
      border: 2px solid #4a7c59;
      background: rgba(116, 185, 163, 0.05);
      margin: 0 auto;
      position: relative;
      overflow: hidden;
    }

    #progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4a7c59, #74b9a3);
      width: 0%;
      transition: width 0.3s ease;
      position: relative;
    }

    #progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: repeating-linear-gradient(45deg,
          transparent,
          transparent 2px,
          rgba(255, 255, 255, 0.1) 2px,
          rgba(255, 255, 255, 0.1) 4px);
    }

    #stats {
      color: #95d5b2;
      margin-bottom: 2rem;
      font-size: 1.1rem;
    }

    #kendallScore {
      color: #74b9a3;
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 1rem;
    }

    .ranking-display {
      background: rgba(116, 185, 163, 0.08);
      border: 2px solid #4a7c59;
      padding: 1rem;
      margin: 1rem 0;
      text-align: left;
      color: #95d5b2;
      font-size: 0.9rem;
      line-height: 1.5;
    }

    .ranking-display h3 {
      color: #74b9a3;
      margin: 0 0 0.5rem 0;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .button-group {
      margin-top: 1.5rem;
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .ascii-art {
      color: #4a7c59;
      font-size: 1rem;
      margin: 1rem 0;
      line-height: 1;
      font-weight: bold;
      letter-spacing: 2px;
    }

    @media (min-width: 1200px) {
      .card {
        padding: 3rem 2rem;
        font-size: 1.3rem;
        min-height: 160px;
      }

      .split {
        max-width: 900px;
        gap: 2rem;
      }
    }

    @media (max-width: 600px) {
      .split {
        flex-direction: column;
      }

      .card {
        margin: 0.5rem 0;
        min-height: 100px;
      }

      h1 {
        font-size: 1.8rem;
        letter-spacing: 2px;
      }

      .button-group {
        flex-direction: column;
        align-items: center;
      }

      #progress-bar {
        width: 250px;
      }
    }
  </style>
</head>

<body>

  <div class="container">
    <div id="welcome">
      <div class="ascii-art">
        [ PAIRWISE COMPARISON ]
      </div>
      <h1>Compare & Choose</h1>
      <p id="stats"></p>
      <button id="startBtn">Start Comparisons</button>
    </div>

    <div id="compare" class="hidden">
      <h2>Which Wikipedia article is more popular?</h2>
      <div id="progress-container">
        <div id="progress-label"></div>
        <div id="progress-bar">
          <div id="progress-fill"></div>
        </div>
      </div>
      <div class="split">
        <div id="left" class="card"></div>
        <div id="right" class="card"></div>
      </div>
    </div>

    <div id="done" class="hidden">
      <div class="ascii-art">
        [ COMPLETE ]
      </div>
      <h2>All Done!</h2>
      <p id="kendallScore"></p>
      <div class="ranking-display">
        <h3>Real Wikipedia Ranking (most to least popular):</h3>
        <div id="realRankingList"></div>
      </div>
      <div class="ranking-display">
        <h3>Your Ranking (based on choices):</h3>
        <div id="userRankingList"></div>
      </div>
      <p>Your encoded results:</p>
      <textarea id="result" readonly></textarea>
      <div class="button-group">
        <button id="copyBtn">Copy to Clipboard</button>
        <button id="restartBtn">Start Over</button>
      </div>
    </div>
  </div>

  <script>
    // ======== CONFIG – EDIT ME ========
    const OPTIONS = [
      { id: 'United_States_Senate', label: 'United States Senate' },
      { id: 'YouTube', label: 'YouTube' },
      { id: 'Facebook', label: 'Facebook' },
      { id: 'United_States', label: 'United States' },
      { id: 'HTTP_404', label: 'HTTP 404' },
      { id: 'Elizabeth_II', label: 'Elizabeth II' },
      { id: 'Cristiano_Ronaldo', label: 'Cristiano Ronaldo' },
      { id: 'Michael_Jackson', label: 'Michael Jackson' }
    ];

    // Ground-truth (real) ranking for Kendall comparison
    const REAL_RANKING = [
      'United_States_Senate',
      'YouTube',
      'Facebook',
      'United_States',
      'HTTP_404',
      'Elizabeth_II',
      'Cristiano_Ronaldo',
      'Michael_Jackson'
    ];
    // ==================================

    let pairs = [], winners = [], current = 0;

    // Utility: all unordered pairs
    function allPairs(n) {
      const result = [];
      for (let i = 0; i < n; i++) {
        for (let j = i + 1; j < n; j++) {
          result.push([i, j]);
        }
      }
      return result;
    }

    // Utility: Fisher-Yates shuffle using crypto
    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = crypto.getRandomValues(new Uint32Array(1))[0] % (i + 1);
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    // Tally wins -> produce a ranking array of option ids (best first)
    function buildRanking() {
      const scores = Array(OPTIONS.length).fill(0);

      // winners[i] contains the id chosen for pairs[i]
      winners.forEach(id => {
        const idx = OPTIONS.findIndex(o => o.id === id);
        if (idx !== -1) scores[idx] += 1;
      });

      // Sort indices by descending score
      return scores
        .map((s, i) => ({ i, s }))
        .sort((a, b) => b.s - a.s)
        .map(obj => OPTIONS[obj.i].id);
    }

    function kendallTau(ranking1, ranking2) {
      const n = ranking1.length;
      let concordant = 0;
      let discordant = 0;

      for (let i = 0; i < n; i++) {
        for (let j = i + 1; j < n; j++) {
          const itemI = ranking2[i];
          const itemJ = ranking2[j];

          const pos1I = ranking1.indexOf(itemI);
          const pos1J = ranking1.indexOf(itemJ);

          if (pos1I < pos1J) {
            concordant++;
          } else {
            discordant++;
          }
        }
      }

      const totalPairs = n * (n - 1) / 2;
      const tau = (concordant - discordant) / totalPairs;
      return tau;
    }

    // DOM helpers
    const $ = id => document.getElementById(id);
    const welcome = $('welcome');
    const compare = $('compare');
    const done = $('done');
    const left = $('left');
    const right = $('right');

    function init() {
      const numPairs = OPTIONS.length * (OPTIONS.length - 1) / 2;
      $('stats').textContent = `${OPTIONS.length} options → ${numPairs} comparisons`;

      $('startBtn').onclick = start;
      $('copyBtn').onclick = copyToClipboard;
      $('restartBtn').onclick = () => location.reload();

      // Add keyboard navigation
      document.addEventListener('keydown', handleKeyPress);
    }

    function handleKeyPress(event) {
      // Only handle keys during comparison phase
      if (!compare.classList.contains('hidden')) {
        const [i, j] = pairs[current];

        if (event.key === 'ArrowLeft') {
          event.preventDefault();
          choose(OPTIONS[i].id);
        } else if (event.key === 'ArrowRight') {
          event.preventDefault();
          choose(OPTIONS[j].id);
        }
      }
    }

    function start() {
      pairs = allPairs(OPTIONS.length);
      shuffle(pairs);
      winners = new Array(pairs.length);
      current = 0;

      welcome.classList.add('hidden');
      compare.classList.remove('hidden');
      renderPair();
    }

    function renderPair() {
      const progress = ((current) / pairs.length) * 100;
      $('progress-label').textContent = `${current + 1} / ${pairs.length}`;
      $('progress-fill').style.width = `${progress}%`;

      const [i, j] = pairs[current];

      left.innerHTML = `<div class="card-arrow">←</div><div>${OPTIONS[i].label}</div>`;
      right.innerHTML = `<div class="card-arrow">→</div><div>${OPTIONS[j].label}</div>`;

      left.onclick = () => choose(OPTIONS[i].id);
      right.onclick = () => choose(OPTIONS[j].id);
    }

    function choose(winnerId) {
      winners[current] = winnerId;
      current++;

      if (current < pairs.length) {
        renderPair();
      } else {
        finish();
      }
    }

    function finish() {
      compare.classList.add('hidden');
      done.classList.remove('hidden');

      // 1) Build ranking from collected votes
      const userRanking = buildRanking();

      // 2) Compute Kendall's τ against ground-truth
      const tau = kendallTau(userRanking, REAL_RANKING);
      $('kendallScore').textContent =
        `Kendall's τ correlation with reference ranking: ${tau.toFixed(2)}`;

      // 3) Display both rankings
      const realRankingLabels = REAL_RANKING.map((id, index) => {
        const option = OPTIONS.find(o => o.id === id);
        return `${index + 1}. ${option ? option.label : id}`;
      });
      $('realRankingList').innerHTML = realRankingLabels.join('<br>');

      const userRankingLabels = userRanking.map((id, index) => {
        const option = OPTIONS.find(o => o.id === id);
        return `${index + 1}. ${option ? option.label : id}`;
      });
      $('userRankingList').innerHTML = userRankingLabels.join('<br>');

      // 4) Produce the encoded payload (unchanged)
      const resultObj = {
        v: 1,
        o: OPTIONS.map(o => o.id),
        p: pairs,
        w: winners
      };

      const json = JSON.stringify(resultObj);
      const encoded = btoa(unescape(encodeURIComponent(json)));

      $('result').value = encoded;
    }

    function copyToClipboard() {
      const result = $('result');
      result.select();
      result.setSelectionRange(0, 99999); // For mobile devices

      if (navigator.clipboard) {
        navigator.clipboard.writeText(result.value).then(() => {
          const btn = $('copyBtn');
          const originalText = btn.textContent;
          btn.textContent = 'Copied!';
          setTimeout(() => btn.textContent = originalText, 2000);
        });
      } else {
        // Fallback for older browsers
        document.execCommand('copy');
        const btn = $('copyBtn');
        const originalText = btn.textContent;
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = originalText, 2000);
      }
    }

    // Initialize on page load
    init();
  </script>
</body>

</html>
